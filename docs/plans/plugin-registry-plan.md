# Plan

设计一个应用层插件注册表，集中管理插件安装与清理，避免各插件自行包装 `app.unmount`，同时兼容现有 router 等插件的使用模式。

## Scope

- In: 插件注册表与安装/清理流程设计与实现，兼容现有插件接口，迁移 router 清理逻辑，补充测试与文档说明。
- Out: 其他功能模块行为调整、渲染逻辑改动、构建/CI 流水线变更。

## Action items

[ ] 梳理现有 `app.use`/`PluginInstallApp` 契约，确定插件对象/函数的兼容要求与扩展点。
[ ] 设计并实现插件注册表：按 `name` 去重记录已安装插件、防重复安装、收集 cleanup 回调，`app.unmount` 时按 LIFO 顺序统一执行并清空，重复 unmount 静默忽略。
[ ] 定义插件接口（`install` + 可选 `cleanup`，函数插件可返回 cleanup），兼容函数式插件的返回清理函数。
[ ] 将 router 安装逻辑迁移到注册表清理机制，去掉对 `app.unmount` 的直接包装，同时保留“一 app 同时仅一个 router”的约束。
[ ] 补充单测覆盖：重复安装防护、卸载触发 cleanup、卸载后重装/切换 router 等场景。
[ ] 更新文档/注释说明新的插件生命周期与清理策略，确认类型导出是否需同步调整。

## Open questions

- 无（去重/顺序/多次调用策略已确定）。
